<!DOCTYPE html>
<html>
	<head>
		<!--- Wes Jenkins 4/12/22 CIT 140 Prather --->
		<meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1">
		<title>Prog5</title>
		
		<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.1.2/handlebars.min.js"></script> 				<!-- Handlebar Template ---> 
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"> 				<!-- Bootstrap --->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>							<!-- Bootstrap --->
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>							<!-- Bootstrap --->
		
	</head>

	<body>
		<div class="container"> 																							<!-- Div for Bootstrap styling --->
			<h2>Select a Major</h2>																							<!-- Heading --->
				<button type='button' class="btn btn-primary" onClick="getData('CIT')">CIT Majors</button>					<!-- Button Calls to Fuction Titled getData (CIT)--->
				<button type='button' class="btn btn-primary" onClick="getData('BUS')">Business Majors</button>  			<!-- Button Calls to Fuction Titled getData (BUS)--->
			<br>																											<!-- Break ---> 
			<br>																											<!-- Break --->
			<p><strong>We filter our dataset by major </strong></p> 
		</div>																												<!-- Closing Tag for Bootstrap Div ---> 
		<div id="majorsTable"></div>
	</body> 

	<script type="text/x-handlebars-template" id="tableTemplate">															<!-- Handlebars Template ---> 
		<table class="table table-striped">																					<!-- Bootstrap --->
			<tr><th>Name</th><th>Major</th><th>Midterm</th><th>Final</th></tr>												<!-- Table Header ---> 
				{{#each rows}}																								<!-- Repeats for Each Object Record --->
					<tr>
						<td>{{name}}</td><td>{{major}}</td><td>{{midterm}}</td><td>{{final}}</td>							<!-- Table Format for Where and How JSON data will placed --->
					</tr>
				{{/each}}
		</table>
	</script>

	<script>
		function getData(selected_major) {																					<!-- Function Creates XML Request --->
			var request = new XMLHttpRequest();
			request.open('GET', 'cit5students.json');                                                              			<!--- Opens JSON file --->
			
			request.onload = function() {                                                                         			<!-- Function Triggers After XML Request for JSON is Completed --->
				var data = JSON.parse(request.responseText);																<!-- Converts JSON into JS array --->
				
				students_by_major = data.filter(getStudents)																<!-- Contains Filtered JSON Data Per Major --->
				function getStudents(item) {																				<!-- Function to Filter JSON Data ---> 
					return item.major == selected_major;																	<!-- Returns Items Equal to the Major --->
				}
				
				if (request.status == 200) {																				<!-- If Statement Checks to See if Data Was Sucessfully Returned --->
					var templateText = document.getElementById('tableTemplate').innerHTML;									<!-- Inner HTML Takes Table Data from Body --->
					var compiledTemplateText = Handlebars.compile(templateText);											<!-- Calls to Handlebars Template to Format the Data ---> 
					compiledHtml = compiledTemplateText({ rows: students_by_major })
					document.getElementById('majorsTable').innerHTML = compiledHtml;                                       	<!-- Inserts Compiled Table into Div --->
				}
				else {
					document.querySelector('#majorsTable').innerHTML = "There was an error, or students by major not found"; <!-- Else Statement if Data Retrieval was Unsuccessful --->
				}
			}
			
			request.send(null);
		}
	</script>
</html>	
